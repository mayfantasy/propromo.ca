query GetProductsByCollectionHandle($handle: String!, $pageSize: Int) {
  collectionByHandle(handle: $handle) {
    ...collectionFields
    products(first: $pageSize) {
      edges {
        cursor
        node {
          ...productFields
        }
      }
      pageInfo {
        hasNextPage
        hasPreviousPage
      }
    }
  }
}
query GetProductByHandle($handle: String!, $pageSize: Int) {
  productByHandle(handle: $handle) {
    ...productWithCollectionsFields
  }
}

fragment productWithCollectionsFields on Product {
  collections(first: $pageSize) {
    edges {
      cursor
      node {
        ...collectionFields
      }
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
    }
  }
  ...productFields
}

fragment productFields on Product {
  id
  description
  descriptionHtml
  handle
  productType
  title
  updatedAt
  vendor
  metafields(first: $pageSize) {
    edges {
      cursor
      node {
        ...producttMetafields
      }
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
    }
  }
  variants(first: $pageSize) {
    edges {
      cursor
      node {
        ...productVariantFields
      }
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
    }
  }
}

fragment productVariantFields on ProductVariant {
  id
  sku
  title
  product {
    handle
  }
  image {
    id
    altText
    originalSrc
  }
  priceV2 {
    amount
    currencyCode
  }
  compareAtPriceV2 {
    amount
    currencyCode
  }
  weight
  weightUnit
}

fragment producttMetafields on Metafield {
  id
  key
  value
  description
}
